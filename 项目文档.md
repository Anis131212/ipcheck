# IPè´¨é‡æ£€æµ‹ç½‘ç«™å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ

**æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„IPè´¨é‡æ£€æµ‹ç³»ç»Ÿéœ€è¦æ•´åˆç¬¬ä¸‰æ–¹APIã€æµè§ˆå™¨æŒ‡çº¹æŠ€æœ¯ã€é«˜å¹¶å‘åç«¯ã€ç°ä»£åŒ–å‰ç«¯å’Œå®¹å™¨åŒ–éƒ¨ç½²ã€‚** æœ¬æ–¹æ¡ˆæä¾›ä»APIé€‰å‹åˆ°ç”Ÿäº§éƒ¨ç½²çš„å…¨æ ˆè§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒ4GBå†…å­˜æœåŠ¡å™¨è¿è¡Œï¼Œå¹¶é›†æˆAIæ™ºèƒ½åˆ†æèƒ½åŠ›ã€‚

---

## ç¬¬ä¸‰æ–¹IPæ£€æµ‹APIå®Œæ•´è°ƒç ”

IPè´¨é‡æ£€æµ‹çš„æ ¸å¿ƒåœ¨äºèšåˆå¤šä¸ªæ•°æ®æºã€‚ä»¥ä¸‹æ˜¯ä¸»æµAPIçš„è¯¦ç»†æŠ€æœ¯è§„æ ¼ï¼š

### IPQualityScoreï¼šæœ€å…¨é¢çš„æ¬ºè¯ˆæ£€æµ‹

IPQualityScoreæä¾›ä¸šç•Œæœ€å®Œæ•´çš„ä»£ç†/VPN/Toræ£€æµ‹èƒ½åŠ›ï¼Œé€‚åˆä½œä¸ºä¸»æ£€æµ‹æºã€‚

```javascript
// APIè°ƒç”¨ç¤ºä¾‹
const response = await fetch(
  `https://www.ipqualityscore.com/api/json/ip/${API_KEY}/${ip}?strictness=1&allow_public_access_points=true`
);
const data = await response.json();

// å…³é”®è¿”å›å­—æ®µ
{
  "fraud_score": 75,        // 0-100ï¼Œâ‰¥75å¯ç–‘ï¼Œâ‰¥90é«˜é£é™©
  "proxy": true,            // æ˜¯å¦ä»£ç†
  "vpn": true,              // æ˜¯å¦VPN
  "tor": false,             // æ˜¯å¦Torå‡ºå£èŠ‚ç‚¹
  "recent_abuse": true,     // è¿‘æœŸæ»¥ç”¨è®°å½•
  "abuse_velocity": "high", // æ»¥ç”¨é¢‘ç‡
  "ISP": "Amazon AWS",
  "ASN": 16509,
  "country_code": "US",
  "city": "Ashburn",
  "connection_type": "Premium required"
}
```

**å®šä»·**ï¼šå…è´¹5,000æ¬¡/æœˆï¼Œä»˜è´¹çº¦$0.0003/æŸ¥è¯¢

### ip-api.comï¼šé›¶æˆæœ¬åœ°ç†å®šä½

å®Œå…¨å…è´¹çš„åœ°ç†ä½ç½®APIï¼Œé€‚åˆè¡¥å……åŸºç¡€ä¿¡æ¯ã€‚

```javascript
// æ³¨æ„ï¼šå…è´¹ç‰ˆä»…æ”¯æŒHTTP
const response = await fetch(`http://ip-api.com/json/${ip}?fields=66846719`);

// è¿”å›å­—æ®µ
{
  "query": "8.8.8.8",
  "country": "United States",
  "countryCode": "US",
  "region": "VA",
  "city": "Ashburn",
  "isp": "Google LLC",
  "org": "Google Public DNS",
  "as": "AS15169 Google LLC",
  "mobile": false,
  "proxy": false,
  "hosting": true
}
```

**é™åˆ¶**ï¼š45æ¬¡/åˆ†é’Ÿï¼Œè¶…é™å°ç¦1å°æ—¶ï¼Œç¦æ­¢å•†ç”¨

### AbuseIPDBï¼šç¤¾åŒºé©±åŠ¨çš„å¨èƒæƒ…æŠ¥

ä¸“æ³¨äºå·²æŠ¥å‘Šçš„æ¶æ„IPæ£€æµ‹ï¼Œæä¾›abuse_confidence_scoreã€‚

```javascript
const response = await fetch('https://api.abuseipdb.com/api/v2/check', {
  method: 'GET',
  headers: {
    'Key': API_KEY,
    'Accept': 'application/json'
  },
  params: { ipAddress: ip, maxAgeInDays: 90 }
});

// å…³é”®å­—æ®µ
{
  "abuseConfidenceScore": 100,  // 0-100æ»¥ç”¨ç½®ä¿¡åº¦
  "totalReports": 47,
  "isTor": false,
  "usageType": "Data Center/Web Hosting",
  "isp": "Tencent Cloud"
}
```

**å…è´¹**ï¼š1,000æ¬¡/å¤©

### APIé€‰æ‹©ç­–ç•¥çŸ©é˜µ

| APIæœåŠ¡ | å…è´¹é¢åº¦ | æ ¸å¿ƒèƒ½åŠ› | æ¨èç”¨é€” |
|---------|----------|----------|----------|
| **IPQualityScore** | 5,000/æœˆ | VPN/ä»£ç†æ£€æµ‹ã€æ¬ºè¯ˆè¯„åˆ† | ä¸»æ£€æµ‹æº |
| **ip-api.com** | 45/åˆ†é’Ÿ | åœ°ç†å®šä½ã€ISPä¿¡æ¯ | å…è´¹è¡¥å…… |
| **ipdata.co** | 1,500/å¤© | å¨èƒæƒ…æŠ¥ã€100+æ•°æ®æº | å¨èƒåˆ†æ |
| **AbuseIPDB** | 1,000/å¤© | ç¤¾åŒºæŠ¥å‘Šã€æ»¥ç”¨å†å² | é»‘åå•æ£€æŸ¥ |
| **IP2Location** | 50,000/æœˆ | ç²¾å‡†åœ°ç†ä½ç½® | å•†ä¸šå®šä½ |

---

## æµè§ˆå™¨æŒ‡çº¹æ£€æµ‹æŠ€æœ¯å®ç°

### WebRTCæ³„éœ²æ£€æµ‹

WebRTCé€šè¿‡STUNåè®®å¯ç»•è¿‡VPNæš´éœ²çœŸå®IPï¼Œè¿™æ˜¯å…³é”®çš„éšç§æ£€æµ‹é¡¹ã€‚

```javascript
async function detectWebRTCLeak() {
  return new Promise((resolve) => {
    const ips = { local: [], public: [] };
    
    const RTCPeerConnection = window.RTCPeerConnection || 
                              window.webkitRTCPeerConnection;
    if (!RTCPeerConnection) {
      resolve({ supported: false });
      return;
    }
    
    const pc = new RTCPeerConnection({
      iceServers: [
        { urls: 'stun:stun.l.google.com:19302' },
        { urls: 'stun:stun.services.mozilla.com' }
      ]
    });
    
    pc.createDataChannel('');
    
    pc.onicecandidate = (event) => {
      if (!event.candidate) {
        pc.close();
        resolve(ips);
        return;
      }
      
      const ipRegex = /([0-9]{1,3}\.){3}[0-9]{1,3}/g;
      const matches = event.candidate.candidate.match(ipRegex);
      
      matches?.forEach(ip => {
        // åˆ¤æ–­ç§æœ‰IP vs å…¬ç½‘IP
        if (ip.match(/^(192\.168\.|10\.|172\.(1[6-9]|2\d|3[01])\.)/)) {
          if (!ips.local.includes(ip)) ips.local.push(ip);
        } else {
          if (!ips.public.includes(ip)) ips.public.push(ip);
        }
      });
    };
    
    pc.createOffer()
      .then(offer => pc.setLocalDescription(offer));
    
    setTimeout(() => { pc.close(); resolve(ips); }, 3000);
  });
}
```

### CanvasæŒ‡çº¹ç”Ÿæˆ

Canvasæ¸²æŸ“å› GPUã€å­—ä½“ã€æŠ—é”¯é½¿å·®å¼‚äº§ç”Ÿå”¯ä¸€æ ‡è¯†ã€‚

```javascript
function getCanvasFingerprint() {
  const canvas = document.createElement('canvas');
  canvas.width = 280;
  canvas.height = 60;
  const ctx = canvas.getContext('2d');
  
  // ç»˜åˆ¶å¤æ‚å›¾å½¢å¢åŠ å”¯ä¸€æ€§
  ctx.textBaseline = 'top';
  ctx.font = "14px 'Arial'";
  ctx.fillStyle = '#f60';
  ctx.fillRect(125, 1, 62, 20);
  
  ctx.fillStyle = '#069';
  ctx.fillText('BrowserLeaks,com <canvas> 1.0', 2, 15);
  
  ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
  ctx.fillText('BrowserLeaks,com <canvas> 1.0', 4, 17);
  
  // é¢œè‰²æ··åˆ
  ctx.globalCompositeOperation = 'multiply';
  ctx.fillStyle = 'rgb(255,0,255)';
  ctx.beginPath();
  ctx.arc(50, 50, 50, 0, Math.PI * 2);
  ctx.fill();
  
  // ç”Ÿæˆå“ˆå¸Œ
  const dataURL = canvas.toDataURL();
  let hash = 0;
  for (let i = 0; i < dataURL.length; i++) {
    hash = ((hash << 5) - hash) + dataURL.charCodeAt(i);
    hash = hash & hash;
  }
  return hash.toString(16);
}
```

### AudioContextæŒ‡çº¹

éŸ³é¢‘å¤„ç†æ ˆçš„ç¡¬ä»¶å·®å¼‚äº§ç”Ÿç‹¬ç‰¹ç­¾åã€‚

```javascript
async function getAudioFingerprint() {
  const AudioContext = window.OfflineAudioContext || 
                       window.webkitOfflineAudioContext;
  if (!AudioContext) return null;
  
  const context = new AudioContext(1, 5000, 44100);
  
  // åˆ›å»ºæŒ¯è¡å™¨
  const oscillator = context.createOscillator();
  oscillator.type = 'triangle';
  oscillator.frequency.value = 1000;
  
  // åŠ¨æ€å‹ç¼©å™¨å¢åŠ è®¾å¤‡å·®å¼‚
  const compressor = context.createDynamicsCompressor();
  compressor.threshold.value = -50;
  compressor.knee.value = 40;
  compressor.ratio.value = 12;
  compressor.attack.value = 0;
  compressor.release.value = 0.2;
  
  oscillator.connect(compressor);
  compressor.connect(context.destination);
  oscillator.start(0);
  
  const buffer = await context.startRendering();
  const samples = buffer.getChannelData(0);
  
  // è®¡ç®—æŒ‡çº¹ï¼šé‡‡æ ·å€¼ç»å¯¹å€¼æ±‚å’Œ
  let fingerprint = 0;
  for (let i = 0; i < samples.length; i++) {
    fingerprint += Math.abs(samples[i]);
  }
  
  return fingerprint; // ä¸åŒè®¾å¤‡å€¼ä¸åŒï¼Œå¦‚Chrome: 124.04, Firefox: 80.95
}
```

### WebGLæŒ‡çº¹ä¸GPUä¿¡æ¯

```javascript
function getWebGLFingerprint() {
  const canvas = document.createElement('canvas');
  const gl = canvas.getContext('webgl');
  if (!gl) return { supported: false };
  
  const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
  
  return {
    vendor: gl.getParameter(gl.VENDOR),
    renderer: gl.getParameter(gl.RENDERER),
    // è·å–çœŸå®GPUä¿¡æ¯
    unmaskedVendor: debugInfo ? 
      gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) : null,
    unmaskedRenderer: debugInfo ? 
      gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : null,
    // ç¤ºä¾‹è¾“å‡º: "ANGLE (Apple, Apple M4 Pro, OpenGL 4.1)"
    maxTextureSize: gl.getParameter(gl.MAX_TEXTURE_SIZE),
    extensions: gl.getSupportedExtensions()?.length || 0
  };
}
```

### å®Œæ•´Navigatorä¿¡æ¯é‡‡é›†

```javascript
function getNavigatorFingerprint() {
  return {
    userAgent: navigator.userAgent,
    platform: navigator.platform,
    language: navigator.language,
    languages: [...(navigator.languages || [])],
    hardwareConcurrency: navigator.hardwareConcurrency,  // CPUæ ¸å¿ƒæ•°
    deviceMemory: navigator.deviceMemory,                // è®¾å¤‡å†…å­˜(GB)
    maxTouchPoints: navigator.maxTouchPoints,
    cookieEnabled: navigator.cookieEnabled,
    webdriver: navigator.webdriver,  // è‡ªåŠ¨åŒ–æ£€æµ‹
    
    // å±å¹•ä¿¡æ¯
    screenWidth: screen.width,
    screenHeight: screen.height,
    colorDepth: screen.colorDepth,
    devicePixelRatio: window.devicePixelRatio,
    
    // æ—¶åŒº
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
    timezoneOffset: new Date().getTimezoneOffset()
  };
}
```

### åä¼ªè£…æ£€æµ‹

```javascript
function detectFingerPrintManipulation() {
  const issues = [];
  
  // æ£€æµ‹UAä¸å¹³å°ä¸ä¸€è‡´
  if (navigator.userAgent.includes('Windows') && 
      navigator.platform.includes('Mac')) {
    issues.push('UAå£°ç§°Windowsä½†å¹³å°æ˜¾ç¤ºMac');
  }
  
  // æ£€æµ‹webdriverï¼ˆè‡ªåŠ¨åŒ–å·¥å…·ï¼‰
  if (navigator.webdriver) {
    issues.push('æ£€æµ‹åˆ°è‡ªåŠ¨åŒ–å·¥å…·');
  }
  
  // Firefoxä¸åº”æœ‰deviceMemory
  if (navigator.userAgent.includes('Firefox') && 
      navigator.deviceMemory !== undefined) {
    issues.push('Firefoxä¸æ”¯æŒdeviceMemory API');
  }
  
  // Canvaså¤šæ¬¡é‡‡æ ·æ£€æµ‹éšæœºåŒ–
  const canvas1 = getCanvasFingerprint();
  const canvas2 = getCanvasFingerprint();
  if (canvas1 !== canvas2) {
    issues.push('CanvasæŒ‡çº¹è¢«éšæœºåŒ–ï¼ˆå¯èƒ½ä½¿ç”¨éšç§å·¥å…·ï¼‰');
  }
  
  return { isManipulated: issues.length > 0, issues };
}
```

---

## åç«¯æ¶æ„è®¾è®¡

### Node.js/Fastifyé«˜å¹¶å‘æ¶æ„

Fastifyæ€§èƒ½å¯è¾¾**30,000è¯·æ±‚/ç§’**ï¼Œæ˜¯Expressçš„2-3å€ã€‚

```javascript
// server.js
import Fastify from 'fastify';
import { checkIPQuality } from './services/ipCheck.js';
import { getOrSetCache } from './utils/redis.js';

const fastify = Fastify({
  logger: true,
  bodyLimit: 1048576  // 1MB
});

// IPæ£€æµ‹è·¯ç”±
fastify.get('/api/check', {
  schema: {
    querystring: {
      type: 'object',
      properties: {
        ip: { type: 'string', format: 'ipv4' }
      }
    }
  }
}, async (request, reply) => {
  const ip = request.query.ip || request.ip;
  
  // IPæ ¼å¼éªŒè¯
  const { isIP } = await import('net');
  if (isIP(ip) === 0) {
    return reply.code(400).send({ error: 'Invalid IP address' });
  }
  
  // Redisç¼“å­˜
  const cacheKey = `ip:check:${ip}`;
  const result = await getOrSetCache(cacheKey, () => checkIPQuality(ip));
  
  return result;
});

// 4GBå†…å­˜æœåŠ¡å™¨ä¼˜åŒ–ï¼š2ä¸ªworkerè¿›ç¨‹
import cluster from 'cluster';
if (cluster.isPrimary) {
  for (let i = 0; i < 2; i++) cluster.fork();
} else {
  fastify.listen({ port: 3000, host: '0.0.0.0' });
}
```

### Redisç¼“å­˜ç­–ç•¥

```javascript
// utils/redis.js
import Redis from 'ioredis';

const redis = new Redis({
  host: process.env.REDIS_HOST || 'localhost',
  enableAutoPipelining: true  // è‡ªåŠ¨ç®¡é“åŒ–æå‡æ€§èƒ½
});

const CACHE_TTL = 900; // 15åˆ†é’Ÿ

export async function getOrSetCache(key, fetchFunction) {
  // æ£€æŸ¥ç¼“å­˜
  const cached = await redis.get(key);
  if (cached) return { ...JSON.parse(cached), fromCache: true };
  
  // åˆ†å¸ƒå¼é”é˜²æ­¢ç¼“å­˜å‡»ç©¿
  const lockKey = `lock:${key}`;
  const acquired = await redis.set(lockKey, '1', 'NX', 'EX', 10);
  
  if (acquired) {
    try {
      const data = await fetchFunction();
      await redis.set(key, JSON.stringify(data), 'EX', CACHE_TTL);
      return data;
    } finally {
      await redis.del(lockKey);
    }
  }
  
  // æœªè·å–é”ï¼Œç­‰å¾…åé‡è¯•
  await new Promise(r => setTimeout(r, 100));
  return getOrSetCache(key, fetchFunction);
}
```

### APIèšåˆå¹¶å‘è¯·æ±‚

```javascript
// services/ipCheck.js
import axios from 'axios';

const API_TIMEOUT = 5000;

export async function checkIPQuality(ip) {
  const apis = [
    {
      name: 'ipqs',
      url: `https://www.ipqualityscore.com/api/json/ip/${process.env.IPQS_KEY}/${ip}`,
      transform: (d) => ({ fraudScore: d.fraud_score, isVpn: d.vpn, isProxy: d.proxy })
    },
    {
      name: 'ipapi',
      url: `http://ip-api.com/json/${ip}`,
      transform: (d) => ({ country: d.country, isp: d.isp, isHosting: d.hosting })
    },
    {
      name: 'abuseipdb',
      url: 'https://api.abuseipdb.com/api/v2/check',
      headers: { Key: process.env.ABUSEIPDB_KEY },
      params: { ipAddress: ip, maxAgeInDays: 90 },
      transform: (d) => ({ abuseScore: d.data.abuseConfidenceScore })
    }
  ];

  // å¹¶å‘è¯·æ±‚æ‰€æœ‰API
  const results = await Promise.allSettled(
    apis.map(api => 
      axios.get(api.url, {
        timeout: API_TIMEOUT,
        headers: api.headers,
        params: api.params
      })
      .then(res => ({ source: api.name, data: api.transform(res.data) }))
      .catch(err => ({ source: api.name, error: err.message }))
    )
  );

  // èšåˆç»“æœ
  const successful = results
    .filter(r => r.status === 'fulfilled' && !r.value.error)
    .map(r => r.value);

  return {
    ip,
    ...mergeResults(successful),
    sources: successful.map(r => r.source),
    timestamp: new Date().toISOString()
  };
}
```

### é€Ÿç‡é™åˆ¶ä¸­é—´ä»¶

```javascript
// middleware/rateLimiter.js
export function rateLimiter({ windowMs = 60000, max = 100 } = {}) {
  return async (request, reply) => {
    const ip = request.ip;
    const key = `rate:${ip}`;
    
    const current = await redis.incr(key);
    if (current === 1) {
      await redis.expire(key, Math.ceil(windowMs / 1000));
    }
    
    reply.header('X-RateLimit-Limit', max);
    reply.header('X-RateLimit-Remaining', Math.max(0, max - current));
    
    if (current > max) {
      return reply.code(429).send({ error: 'Too Many Requests' });
    }
  };
}
```

### é¡¹ç›®ç›®å½•ç»“æ„

```
ip-checker/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ index.js          # ç¯å¢ƒå˜é‡é…ç½®
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ ipCheck.js        # APIèšåˆæœåŠ¡
â”‚   â”‚   â””â”€â”€ aiAnalysis.js     # AIåˆ†ææœåŠ¡
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ rateLimiter.js
â”‚   â”‚   â””â”€â”€ cache.js
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ redis.js
â”‚   â”‚   â””â”€â”€ validators.js
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ api.js
â”‚   â””â”€â”€ server.js
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ App.jsx
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ nginx.conf
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â””â”€â”€ .env
```

---

## å‰ç«¯å•é¡µåº”ç”¨è®¾è®¡

### UIè®¾è®¡å‚è€ƒè¦ç‚¹

å‚è€ƒBrowserLeakså’ŒWhoer.netçš„è®¾è®¡ç‰¹ç‚¹ï¼š

- **ä¿¡æ¯åˆ†åŒºå±•ç¤º**ï¼šç½‘ç»œä¿¡æ¯ã€æµè§ˆå™¨æŒ‡çº¹ã€é£é™©è¯„ä¼°ç‹¬ç«‹æ¨¡å—
- **å®æ—¶æ£€æµ‹è¿›åº¦**ï¼šé€é¡¹å®ŒæˆåŠ¨ç”»ï¼Œæ˜¾ç¤ºæ£€æµ‹çŠ¶æ€
- **é£é™©å¯è§†åŒ–**ï¼šä»ªè¡¨ç›˜å¼è¯„åˆ†å±•ç¤ºï¼Œé¢œè‰²ç¼–ç é£é™©ç­‰çº§
- **è¯¦æƒ…æŠ˜å **ï¼šå…³é”®ä¿¡æ¯ä¼˜å…ˆï¼Œè¯¦æƒ…å¯å±•å¼€

### Reactæ ¸å¿ƒç»„ä»¶ç¤ºä¾‹

```jsx
// components/IPCheckResult.jsx
import { useState, useEffect } from 'react';

export function IPCheckResult({ ip }) {
  const [result, setResult] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    fetch(`/api/check?ip=${ip}`)
      .then(res => res.json())
      .then(data => { setResult(data); setLoading(false); });
  }, [ip]);
  
  if (loading) return <LoadingSpinner />;
  
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
      {/* é£é™©è¯„åˆ†å¡ */}
      <div className="bg-white rounded-lg shadow p-6">
        <h3 className="text-lg font-semibold mb-4">é£é™©è¯„åˆ†</h3>
        <RiskGauge score={result.fraudScore} />
        <div className="mt-4 space-y-2">
          <StatusBadge label="VPNæ£€æµ‹" status={result.isVpn} />
          <StatusBadge label="ä»£ç†æ£€æµ‹" status={result.isProxy} />
          <StatusBadge label="Torç½‘ç»œ" status={result.isTor} />
        </div>
      </div>
      
      {/* åœ°ç†ä¿¡æ¯ */}
      <div className="bg-white rounded-lg shadow p-6">
        <h3 className="text-lg font-semibold mb-4">åœ°ç†ä½ç½®</h3>
        <InfoRow label="å›½å®¶" value={result.country} />
        <InfoRow label="åŸå¸‚" value={result.city} />
        <InfoRow label="ISP" value={result.isp} />
        <InfoRow label="ASN" value={result.asn} />
      </div>
    </div>
  );
}

function RiskGauge({ score }) {
  const color = score >= 75 ? 'red' : score >= 50 ? 'yellow' : 'green';
  return (
    <div className="relative w-32 h-32 mx-auto">
      <svg viewBox="0 0 100 50">
        <path d="M10,50 A40,40 0 1,1 90,50" 
              fill="none" stroke="#e5e7eb" strokeWidth="8"/>
        <path d="M10,50 A40,40 0 1,1 90,50" 
              fill="none" stroke={color} strokeWidth="8"
              strokeDasharray={`${score * 1.26} 126`}/>
      </svg>
      <div className="absolute inset-0 flex items-center justify-center">
        <span className="text-3xl font-bold">{score}</span>
      </div>
    </div>
  );
}
```

### å‰ç«¯æŒ‡çº¹æ£€æµ‹é›†æˆ

```javascript
// hooks/useFingerprint.js
import { useState, useEffect } from 'react';

export function useFingerprint() {
  const [fingerprint, setFingerprint] = useState(null);
  
  useEffect(() => {
    async function collect() {
      const fp = {
        webrtc: await detectWebRTCLeak(),
        canvas: getCanvasFingerprint(),
        audio: await getAudioFingerprint(),
        webgl: getWebGLFingerprint(),
        navigator: getNavigatorFingerprint()
      };
      setFingerprint(fp);
    }
    collect();
  }, []);
  
  return fingerprint;
}
```

---

## Dockeréƒ¨ç½²é…ç½®

### Node.jså¤šé˜¶æ®µDockerfile

```dockerfile
# Dockerfile
# Stage 1: Build
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

# Stage 2: Production
FROM node:20-alpine
WORKDIR /app

# å®‰å…¨ï¼šä½¿ç”¨érootç”¨æˆ·
RUN addgroup -S appgroup && adduser -S appuser -G appgroup
USER appuser

COPY --from=builder /app/node_modules ./node_modules
COPY . .

# 4GBå†…å­˜ä¼˜åŒ–
ENV NODE_OPTIONS="--max-old-space-size=1024"
ENV NODE_ENV=production

EXPOSE 3000
CMD ["node", "src/server.js"]
```

### å‰ç«¯å¤šé˜¶æ®µæ„å»º

```dockerfile
# frontend/Dockerfile
FROM node:20-alpine AS build
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
```

### docker-compose.ymlå®Œæ•´é…ç½®

```yaml
version: '3.8'
services:
  # Node.jsåç«¯
  api:
    build: .
    environment:
      - NODE_ENV=production
      - REDIS_HOST=redis
      - IPQS_KEY=${IPQS_KEY}
      - ABUSEIPDB_KEY=${ABUSEIPDB_KEY}
    depends_on:
      - redis
    networks:
      - app-network
    deploy:
      resources:
        limits:
          memory: 1536M
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:3000/health')"]
      interval: 30s
      timeout: 10s

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    command: >
      redis-server
      --maxmemory 256mb
      --maxmemory-policy allkeys-lru
      --appendonly no
    volumes:
      - redis_data:/data
    networks:
      - app-network
    deploy:
      resources:
        limits:
          memory: 384M

  # Nginxåå‘ä»£ç†
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/ssl:/etc/nginx/ssl:ro
    depends_on:
      - api
      - frontend
    networks:
      - app-network
    restart: unless-stopped

  # å‰ç«¯é™æ€æœåŠ¡
  frontend:
    build: ./frontend
    networks:
      - app-network

volumes:
  redis_data:

networks:
  app-network:
    driver: bridge
```

### Nginxåå‘ä»£ç†é…ç½®

```nginx
# nginx/nginx.conf
events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_types text/plain application/json application/javascript text/css;
    gzip_min_length 1000;
    
    # ä¸Šæ¸¸æœåŠ¡
    upstream api_backend {
        server api:3000;
        keepalive 32;
    }
    
    server {
        listen 80;
        server_name _;
        
        # å‰ç«¯é™æ€æ–‡ä»¶
        location / {
            proxy_pass http://frontend:80;
            proxy_cache_bypass $http_upgrade;
        }
        
        # APIåå‘ä»£ç†
        location /api/ {
            proxy_pass http://api_backend;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_read_timeout 60s;
        }
        
        # é™æ€èµ„æºç¼“å­˜
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 30d;
            add_header Cache-Control "public, immutable";
        }
    }
}
```

### 4GBå†…å­˜æœåŠ¡å™¨ä¼˜åŒ–é…ç½®

| ç»„ä»¶ | å†…å­˜åˆ†é… | é…ç½®å‚æ•° |
|------|----------|----------|
| Node.js API | 1.5GB | `--max-old-space-size=1024`ï¼Œ2ä¸ªworker |
| Redis | 384MB | `maxmemory 256mb`ï¼ŒLRUæ·˜æ±° |
| Nginx | 128MB | `worker_connections 1024` |
| ç³»ç»Ÿä¿ç•™ | ~1GB | åŒ…å«Dockerå¼€é”€ |

---

## AIåˆ†æåŠŸèƒ½é›†æˆ

### å¯é…ç½®çš„AIæœåŠ¡æ¨¡å—

```javascript
// services/aiAnalysis.js
import OpenAI from 'openai';

class AIAnalysisService {
  constructor(config) {
    this.client = new OpenAI({
      apiKey: config.apiKey,
      baseURL: config.baseURL || 'https://api.openai.com/v1',
      timeout: 60000,
      maxRetries: 2
    });
    this.model = config.model || 'gpt-4o-mini';
  }

  async analyzeIPData(ipData) {
    const completion = await this.client.chat.completions.create({
      model: this.model,
      messages: [
        { role: 'system', content: SYSTEM_PROMPT },
        { role: 'user', content: JSON.stringify(ipData, null, 2) }
      ],
      temperature: 0.3,
      max_tokens: 2000
    });
    
    return {
      analysis: completion.choices[0].message.content,
      usage: completion.usage
    };
  }

  // æµå¼å“åº”
  async *analyzeStream(ipData) {
    const stream = await this.client.chat.completions.create({
      model: this.model,
      messages: [
        { role: 'system', content: SYSTEM_PROMPT },
        { role: 'user', content: JSON.stringify(ipData) }
      ],
      stream: true
    });

    for await (const chunk of stream) {
      const content = chunk.choices[0]?.delta?.content;
      if (content) yield content;
    }
  }
}
```

### AIåˆ†æPromptæ¨¡æ¿

```javascript
const SYSTEM_PROMPT = `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ç½‘ç»œå®‰å…¨åˆ†æå¸ˆï¼Œä¸“é—¨åˆ†æIPåœ°å€çš„å®‰å…¨é£é™©ã€‚

åˆ†æç»´åº¦ï¼š
1. åŒ¿ååŒ–å·¥å…·æ£€æµ‹ï¼ˆVPN/ä»£ç†/Torï¼‰
2. IPä¿¡èª‰å’Œå†å²æ»¥ç”¨è®°å½•
3. åœ°ç†ä½ç½®ä¸€è‡´æ€§
4. ç½‘ç»œç±»å‹é£é™©ï¼ˆæ•°æ®ä¸­å¿ƒ/ä½å®…/ç§»åŠ¨ï¼‰

è¾“å‡ºè¦æ±‚ï¼š
- ä½¿ç”¨Markdownæ ¼å¼
- é£é™©è¯„åˆ†(1-100)å’Œç­‰çº§(ä½å±/ä¸­å±/é«˜å±/ä¸¥é‡)
- å…³é”®å‘ç°åˆ—è¡¨
- å…·ä½“å®‰å…¨å»ºè®®`;

const USER_PROMPT_TEMPLATE = `## IPå®‰å…¨é£é™©è¯„ä¼°

è¯·å¯¹ä»¥ä¸‹IPæ£€æµ‹æ•°æ®è¿›è¡Œå…¨é¢åˆ†æï¼š

{{IP_DATA}}

æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼š

### ğŸ“Š é£é™©è¯„åˆ†
- æ€»ä½“é£é™©: X/100
- é£é™©ç­‰çº§: [ä½å±/ä¸­å±/é«˜å±/ä¸¥é‡]

### ğŸ” å…³é”®å‘ç°
1. [å‘ç°1]
2. [å‘ç°2]

### âš ï¸ é£é™©å› ç´ 
| ç±»å‹ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|

### ğŸ’¡ å®‰å…¨å»ºè®®
1. [å»ºè®®1]`;
```

### æµå¼å“åº”APIç«¯ç‚¹

```javascript
// routes/ai.js
fastify.post('/api/ai/analyze', async (request, reply) => {
  const { ipData, config } = request.body;
  
  // åˆ›å»ºAIæœåŠ¡å®ä¾‹ï¼ˆæ”¯æŒè‡ªå®šä¹‰é…ç½®ï¼‰
  const ai = new AIAnalysisService({
    apiKey: config?.apiKey || process.env.OPENAI_API_KEY,
    baseURL: config?.baseURL,
    model: config?.model
  });
  
  // æµå¼å“åº”
  reply.raw.writeHead(200, {
    'Content-Type': 'text/event-stream',
    'Cache-Control': 'no-cache',
    'Connection': 'keep-alive'
  });
  
  for await (const chunk of ai.analyzeStream(ipData)) {
    reply.raw.write(`data: ${JSON.stringify({ content: chunk })}\n\n`);
  }
  
  reply.raw.write('data: [DONE]\n\n');
  reply.raw.end();
});
```

### æˆæœ¬ä¼˜åŒ–ç­–ç•¥

| æ¨¡å‹ | è¾“å…¥ä»·æ ¼ | è¾“å‡ºä»·æ ¼ | æ¨èç”¨é€” |
|------|----------|----------|----------|
| gpt-4o-mini | $0.15/1M | $0.60/1M | **æ—¥å¸¸åˆ†æï¼Œæ€§ä»·æ¯”æœ€é«˜** |
| gpt-3.5-turbo | $0.50/1M | $1.50/1M | ç®€å•ä»»åŠ¡ |
| gpt-4o | $2.50/1M | $10/1M | å¤æ‚å¨èƒæƒ…æŠ¥ |

**ç¼“å­˜ç­–ç•¥**ï¼šç›¸åŒIPé£é™©ç‰¹å¾çš„åˆ†æç»“æœç¼“å­˜24å°æ—¶ï¼Œå¯é™ä½90%+ APIè°ƒç”¨ã€‚

---

## å¿«é€Ÿå¯åŠ¨æŒ‡å—

```bash
# 1. å…‹éš†å¹¶é…ç½®
git clone your-repo && cd ip-checker
cp .env.example .env
# ç¼–è¾‘.envå¡«å…¥APIå¯†é’¥

# 2. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 3. è®¿é—®
# å‰ç«¯: http://localhost
# API: http://localhost/api/check?ip=8.8.8.8
```
